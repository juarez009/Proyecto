{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\alero\\\\OneDrive\\\\Documentos\\\\GitHub\\\\proyecto\\\\parte C\\\\src\\\\components\\\\ventas\\\\Ventas.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from \"react\";\nimport axios from \"axios\";\nimport Swal from \"sweetalert2\";\nimport Web3 from 'web3';\nimport EthereumQRCode from './EthereumQRCode';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction Ventas() {\n  _s();\n  const [productos, setProductos] = useState([]);\n  const [carrito, setCarrito] = useState([]);\n  const [totalVenta, setTotalVenta] = useState(0);\n  const [direccionWallet, setDireccionWallet] = useState(\"\");\n  const [showQRDialog, setShowQRDialog] = useState(false); // Agrega la dirección de la wallet aquí\n  const value = Web3.utils.toWei(totalVenta.toString(), 'ether');\n  useEffect(() => {\n    // Realizar una solicitud GET al servidor backend para obtener los productos\n    axios.get(\"http://localhost:3001/api/productos\").then(response => {\n      setProductos(response.data);\n    }).catch(error => {\n      console.error(\"Error al obtener productos:\", error);\n    });\n\n    // Establecer la dirección de la wallet (reemplaza 'WALLET' con la dirección correcta)\n    setDireccionWallet(\"0x94B61F40c0C48a8E78D6EAa134D728DC5a47564C\");\n  }, []);\n\n  // Función para agregar un producto al carrito y actualizar el stock en la base de datos\n  const agregarAlCarrito = producto => {\n    // Buscar el producto en la lista de productos\n    const productoEnStock = productos.find(item => item.id === producto.id);\n    if (productoEnStock && productoEnStock.stock > 0) {\n      // Verificar si hay suficiente stock disponible\n      const productoEnCarrito = carrito.find(item => item.id === producto.id);\n      if (productoEnCarrito) {\n        // Si el producto ya está en el carrito, incrementar la cantidad\n        const nuevoCarrito = carrito.map(item => {\n          if (item.id === producto.id) {\n            return {\n              ...item,\n              cantidad: item.cantidad + 1\n            };\n          }\n          return item;\n        });\n        setCarrito(nuevoCarrito);\n      } else {\n        // Si el producto no está en el carrito, agregarlo con cantidad 1\n        setCarrito([...carrito, {\n          ...producto,\n          cantidad: 1\n        }]);\n      }\n\n      // Reducir el stock en uno\n      productoEnStock.stock -= 1;\n\n      // Actualizar la lista de productos en el estado (esto es importante para mostrar \"Producto Agotado\")\n      setProductos([...productos]);\n\n      // Actualizar el stock en la base de datos\n      axios.post(`http://localhost:3001/api/productos/${producto.id}/actualizarStock`, {\n        nuevoStock: productoEnStock.stock\n      }).then(response => {\n        console.log(\"Stock actualizado en la base de datos\");\n      }).catch(error => {\n        console.error(\"Error al actualizar el stock en la base de datos:\", error);\n      });\n      setTotalVenta(totalVenta + producto.precio);\n    } else {\n      // Producto agotado o sin stock\n      alert(\"Producto Agotado\");\n    }\n  };\n  const desagregarDelCarrito = producto => {\n    // Buscar el producto en el carrito\n    const productoEnCarrito = carrito.find(item => item.id === producto.id);\n    if (productoEnCarrito) {\n      if (productoEnCarrito.cantidad === 1) {\n        // Si la cantidad es 1, eliminar el producto del carrito\n        eliminarDelCarrito(producto);\n      } else {\n        // Si la cantidad es mayor que 1, reducir la cantidad en uno\n        const nuevoCarrito = carrito.map(item => {\n          if (item.id === producto.id) {\n            return {\n              ...item,\n              cantidad: item.cantidad - 1\n            };\n          }\n          return item;\n        });\n        setCarrito(nuevoCarrito);\n\n        // Aumentar el stock en uno\n        const productoEnStock = productos.find(item => item.id === producto.id);\n        productoEnStock.stock += 1;\n\n        // Actualizar la lista de productos en el estado\n        setProductos([...productos]);\n\n        // Actualizar el stock en la base de datos\n        axios.post(`http://localhost:3001/api/productos/${producto.id}/actualizarStock`, {\n          nuevoStock: productoEnStock.stock\n        }).then(response => {\n          console.log(\"Stock actualizado en la base de datos\");\n        }).catch(error => {\n          console.error(\"Error al actualizar el stock en la base de datos:\", error);\n        });\n\n        // Reducir el total de venta en el precio del producto\n        setTotalVenta(totalVenta - producto.precio);\n      }\n    }\n  };\n\n  // Función para eliminar un producto del carrito\n  const eliminarDelCarrito = producto => {\n    const nuevoCarrito = carrito.filter(item => item.id !== producto.id);\n    setCarrito(nuevoCarrito);\n    setTotalVenta(totalVenta - producto.precio * producto.cantidad);\n\n    // Devolver el stock al producto en la base de datos\n    const productoEnStock = productos.find(item => item.id === producto.id);\n    productoEnStock.stock += producto.cantidad;\n\n    // Actualizar la lista de productos en el estado (esto es importante para mostrar el stock actualizado)\n    setProductos([...productos]);\n\n    // Actualizar el stock en la base de datos\n    axios.post(`http://localhost:3001/api/productos/${producto.id}/actualizarStock`, {\n      nuevoStock: productoEnStock.stock\n    }).then(response => {\n      console.log(\"Stock actualizado en la base de datos\");\n    }).catch(error => {\n      console.error(\"Error al actualizar el stock en la base de datos:\", error);\n    });\n  };\n  const cambiarCantidad = (producto, nuevaCantidad) => {\n    const nuevoCarrito = carrito.map(item => {\n      if (item.id === producto.id) {\n        return {\n          ...item,\n          cantidad: nuevaCantidad\n        };\n      }\n      return item;\n    });\n    setCarrito(nuevoCarrito);\n    calcularTotalVenta(nuevoCarrito);\n  };\n\n  // Función para calcular el total de la venta\n  const calcularTotalVenta = nuevoCarrito => {\n    let nuevoTotal = 0;\n    nuevoCarrito.forEach(item => {\n      nuevoTotal += item.precio * item.cantidad;\n    });\n    setTotalVenta(nuevoTotal);\n  };\n  const realizarPago = () => {\n    // Verificar si hay productos en el carrito y el total de compra es mayor que cero\n    if (carrito.length === 0 || totalVenta === 0) {\n      Swal.fire({\n        title: \"No hay productos en el carrito\",\n        icon: \"error\",\n        confirmButtonText: \"Ok\"\n      });\n    } else {\n      // Generar el contenido del código QR y mostrarlo;\n\n      setShowQRDialog(true);\n    }\n  };\n  const manejarPago = async () => {\n    try {\n      // Verificar si MetaMask está instalado\n      if (typeof window.ethereum !== 'undefined') {\n        const web3 = new Web3(window.ethereum);\n\n        // Comprobar si el usuario está conectado\n        const accounts = await web3.eth.getAccounts();\n        if (accounts.length === 0) {\n          throw new Error(\"No se ha detectado una billetera Ethereum.\");\n        }\n\n        // Crear una transacción para enviar el pago a la dirección de la billetera\n        const transaction = {\n          to: direccionWallet,\n          // Dirección de destino\n          value: web3.utils.toWei(totalVenta.toString(), \"ether\") // Monto en Wei\n        };\n\n        // Enviar la transacción a través de MetaMask\n        await web3.eth.sendTransaction(transaction);\n\n        // Transacción exitosa, mostrar un mensaje\n        Swal.fire({\n          title: \"Pago exitoso\",\n          icon: \"success\",\n          text: `Se ha realizado un pago de ${totalVenta} Ether a la dirección ${direccionWallet}.`,\n          confirmButtonText: \"Ok\"\n        });\n\n        // Cerrar el cuadro de diálogo QR y reiniciar el estado\n        setShowQRDialog(false);\n        setCarrito([]);\n        setTotalVenta(0);\n      } else {\n        throw new Error(\"MetaMask no está instalado o no está disponible.\");\n      }\n    } catch (error) {\n      // Manejar errores, por ejemplo, si el usuario rechaza la transacción en MetaMask\n      Swal.fire({\n        title: \"Error en el pago\",\n        icon: \"error\",\n        text: \"Se produjo un error al procesar el pago.\",\n        confirmButtonText: \"Ok\"\n      });\n    }\n  };\n  const handleVolverAtras = () => {\n    window.history.back();\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container\",\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      children: \"Productos en Venta\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 256,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: handleVolverAtras,\n      children: \"Volver Atr\\xE1s\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 257,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 258,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 259,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"row\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"col-md-9\",\n        style: {\n          maxHeight: \"600px\",\n          overflowY: \"scroll\"\n        },\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"row\",\n          children: productos.map(producto => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"col-md-4 mb-4\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"card\",\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"card-body\",\n                children: [/*#__PURE__*/_jsxDEV(\"h5\", {\n                  className: \"card-title\",\n                  children: producto.nombre\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 270,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                  className: \"card-text\",\n                  children: producto.descripcion\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 271,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                  className: \"card-text\",\n                  children: [\"Precio: \", producto.precio]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 272,\n                  columnNumber: 21\n                }, this), producto.stock > 0 ? /*#__PURE__*/_jsxDEV(\"button\", {\n                  className: \"btn btn-primary\",\n                  onClick: () => agregarAlCarrito(producto),\n                  children: \"Agregar\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 274,\n                  columnNumber: 23\n                }, this) : /*#__PURE__*/_jsxDEV(\"p\", {\n                  className: \"text-danger\",\n                  children: \"Producto Agotado\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 281,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 269,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 268,\n              columnNumber: 17\n            }, this)\n          }, producto.id, false, {\n            fileName: _jsxFileName,\n            lineNumber: 267,\n            columnNumber: 15\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 265,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 261,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"col-md-3\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mt-2\",\n          style: {\n            maxHeight: \"500px\",\n            overflowY: \"scroll\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            children: \"Ticket\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 294,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"table\", {\n            className: \"table table-sm\",\n            children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n              children: /*#__PURE__*/_jsxDEV(\"tr\", {\n                children: [/*#__PURE__*/_jsxDEV(\"th\", {\n                  children: \"Producto\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 298,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                  children: \"Cantidad\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 299,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                  children: \"Precio\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 300,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n                  children: \"Acci\\xF3n\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 301,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 297,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 296,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n              children: carrito.map((item, index) => /*#__PURE__*/_jsxDEV(\"tr\", {\n                children: [/*#__PURE__*/_jsxDEV(\"td\", {\n                  children: item.nombre\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 307,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                  children: /*#__PURE__*/_jsxDEV(\"input\", {\n                    type: \"number\",\n                    min: \"1\",\n                    className: \"form-control\",\n                    value: item.cantidad,\n                    onChange: e => cambiarCantidad(item, parseInt(e.target.value))\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 309,\n                    columnNumber: 23\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 308,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                  children: (item.precio * item.cantidad).toFixed(2)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 319,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n                  children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                    className: \"btn btn-primary\",\n                    onClick: () => agregarAlCarrito(item),\n                    children: \"+\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 321,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                    className: \"btn btn-warning\",\n                    onClick: () => desagregarDelCarrito(item),\n                    children: \"-\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 327,\n                    columnNumber: 23\n                  }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                    className: \"btn btn-danger\",\n                    onClick: () => eliminarDelCarrito(item),\n                    children: \"Quitar\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 333,\n                    columnNumber: 23\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 320,\n                  columnNumber: 21\n                }, this)]\n              }, index, true, {\n                fileName: _jsxFileName,\n                lineNumber: 306,\n                columnNumber: 19\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 304,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 295,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 290,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"total-venta\",\n          children: [\"Total de Venta: \", /*#__PURE__*/_jsxDEV(\"strong\", {\n            children: totalVenta.toFixed(2)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 346,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 345,\n          columnNumber: 11\n        }, this), carrito.length > 0 && /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn btn-success\",\n          onClick: realizarPago,\n          \"data-bs-toggle\": \"modal\",\n          \"data-bs-target\": \"#exampleModal\",\n          children: \"Pago\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 349,\n          columnNumber: 13\n        }, this), showQRDialog && /*#__PURE__*/_jsxDEV(\"div\", {\n          class: \"modal fade\",\n          id: \"exampleModal\",\n          tabindex: \"-1\",\n          \"aria-labelledby\": \"exampleModalLabel\",\n          \"aria-hidden\": \"true\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            class: \"modal-dialog\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              class: \"modal-content\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                class: \"modal-header\",\n                children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n                  class: \"modal-title fs-5\",\n                  id: \"exampleModalLabel\",\n                  children: \"Modal title\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 358,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                  type: \"button\",\n                  class: \"btn-close\",\n                  \"data-bs-dismiss\": \"modal\",\n                  \"aria-label\": \"Close\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 359,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 357,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                class: \"modal-body\",\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"qr-dialog\",\n                  children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n                    children: \"Escanee el c\\xF3digo QR para realizar el pago\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 364,\n                    columnNumber: 11\n                  }, this), /*#__PURE__*/_jsxDEV(EthereumQRCode, {\n                    address: direccionWallet,\n                    amount: value\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 365,\n                    columnNumber: 11\n                  }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                    children: [\"Total de Venta: \", /*#__PURE__*/_jsxDEV(\"strong\", {\n                      children: totalVenta.toFixed(2)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 366,\n                      columnNumber: 30\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 366,\n                    columnNumber: 11\n                  }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                    className: \"btn btn-primary\",\n                    onClick: manejarPago,\n                    children: \"Realizar Pago\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 367,\n                    columnNumber: 11\n                  }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                    className: \"btn btn-secondary\",\n                    onClick: () => setShowQRDialog(false),\n                    children: \"Cancelar\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 373,\n                    columnNumber: 11\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 362,\n                  columnNumber: 17\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 361,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                class: \"modal-footer\",\n                children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                  type: \"button\",\n                  class: \"btn btn-secondary\",\n                  \"data-bs-dismiss\": \"modal\",\n                  children: \"Close\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 382,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                  type: \"button\",\n                  class: \"btn btn-primary\",\n                  children: \"Save changes\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 383,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 381,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 356,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 355,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 354,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 289,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 260,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 255,\n    columnNumber: 5\n  }, this);\n}\n_s(Ventas, \"xAFVdzf/lBO4Ou51IHyJsLcYyDA=\");\n_c = Ventas;\nexport default Ventas;\nvar _c;\n$RefreshReg$(_c, \"Ventas\");","map":{"version":3,"names":["React","useEffect","useState","axios","Swal","Web3","EthereumQRCode","jsxDEV","_jsxDEV","Ventas","_s","productos","setProductos","carrito","setCarrito","totalVenta","setTotalVenta","direccionWallet","setDireccionWallet","showQRDialog","setShowQRDialog","value","utils","toWei","toString","get","then","response","data","catch","error","console","agregarAlCarrito","producto","productoEnStock","find","item","id","stock","productoEnCarrito","nuevoCarrito","map","cantidad","post","nuevoStock","log","precio","alert","desagregarDelCarrito","eliminarDelCarrito","filter","cambiarCantidad","nuevaCantidad","calcularTotalVenta","nuevoTotal","forEach","realizarPago","length","fire","title","icon","confirmButtonText","manejarPago","window","ethereum","web3","accounts","eth","getAccounts","Error","transaction","to","sendTransaction","text","handleVolverAtras","history","back","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","style","maxHeight","overflowY","nombre","descripcion","index","type","min","onChange","e","parseInt","target","toFixed","class","tabindex","address","amount","_c","$RefreshReg$"],"sources":["C:/Users/alero/OneDrive/Documentos/GitHub/proyecto/parte C/src/components/ventas/Ventas.jsx"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport axios from \"axios\";\r\nimport Swal from \"sweetalert2\";\r\nimport Web3 from 'web3';\r\nimport EthereumQRCode from './EthereumQRCode';\r\n\r\nfunction Ventas() {\r\n  const [productos, setProductos] = useState([]);\r\n  const [carrito, setCarrito] = useState([]);\r\n  const [totalVenta, setTotalVenta] = useState(0);\r\n  const [direccionWallet, setDireccionWallet] = useState(\"\");\r\n  const [showQRDialog, setShowQRDialog] = useState(false); // Agrega la dirección de la wallet aquí\r\n  const value = Web3.utils.toWei(totalVenta.toString(), 'ether');\r\n\r\n  useEffect(() => {\r\n    // Realizar una solicitud GET al servidor backend para obtener los productos\r\n    axios\r\n      .get(\"http://localhost:3001/api/productos\")\r\n      .then((response) => {\r\n        setProductos(response.data);\r\n      })\r\n      .catch((error) => {\r\n        console.error(\"Error al obtener productos:\", error);\r\n      });\r\n\r\n    // Establecer la dirección de la wallet (reemplaza 'WALLET' con la dirección correcta)\r\n    setDireccionWallet(\"0x94B61F40c0C48a8E78D6EAa134D728DC5a47564C\");\r\n  }, []);\r\n\r\n  // Función para agregar un producto al carrito y actualizar el stock en la base de datos\r\n  const agregarAlCarrito = (producto) => {\r\n    // Buscar el producto en la lista de productos\r\n    const productoEnStock = productos.find((item) => item.id === producto.id);\r\n\r\n    if (productoEnStock && productoEnStock.stock > 0) {\r\n      // Verificar si hay suficiente stock disponible\r\n      const productoEnCarrito = carrito.find((item) => item.id === producto.id);\r\n\r\n      if (productoEnCarrito) {\r\n        // Si el producto ya está en el carrito, incrementar la cantidad\r\n        const nuevoCarrito = carrito.map((item) => {\r\n          if (item.id === producto.id) {\r\n            return { ...item, cantidad: item.cantidad + 1 };\r\n          }\r\n          return item;\r\n        });\r\n        setCarrito(nuevoCarrito);\r\n      } else {\r\n        // Si el producto no está en el carrito, agregarlo con cantidad 1\r\n        setCarrito([...carrito, { ...producto, cantidad: 1 }]);\r\n      }\r\n\r\n      // Reducir el stock en uno\r\n      productoEnStock.stock -= 1;\r\n\r\n      // Actualizar la lista de productos en el estado (esto es importante para mostrar \"Producto Agotado\")\r\n      setProductos([...productos]);\r\n\r\n      // Actualizar el stock en la base de datos\r\n      axios\r\n        .post(\r\n          `http://localhost:3001/api/productos/${producto.id}/actualizarStock`,\r\n          {\r\n            nuevoStock: productoEnStock.stock,\r\n          }\r\n        )\r\n        .then((response) => {\r\n          console.log(\"Stock actualizado en la base de datos\");\r\n        })\r\n        .catch((error) => {\r\n          console.error(\r\n            \"Error al actualizar el stock en la base de datos:\",\r\n            error\r\n          );\r\n        });\r\n\r\n      setTotalVenta(totalVenta + producto.precio);\r\n    } else {\r\n      // Producto agotado o sin stock\r\n      alert(\"Producto Agotado\");\r\n    }\r\n  };\r\n\r\n  const desagregarDelCarrito = (producto) => {\r\n    // Buscar el producto en el carrito\r\n    const productoEnCarrito = carrito.find((item) => item.id === producto.id);\r\n\r\n    if (productoEnCarrito) {\r\n      if (productoEnCarrito.cantidad === 1) {\r\n        // Si la cantidad es 1, eliminar el producto del carrito\r\n        eliminarDelCarrito(producto);\r\n      } else {\r\n        // Si la cantidad es mayor que 1, reducir la cantidad en uno\r\n        const nuevoCarrito = carrito.map((item) => {\r\n          if (item.id === producto.id) {\r\n            return { ...item, cantidad: item.cantidad - 1 };\r\n          }\r\n          return item;\r\n        });\r\n        setCarrito(nuevoCarrito);\r\n\r\n        // Aumentar el stock en uno\r\n        const productoEnStock = productos.find(\r\n          (item) => item.id === producto.id\r\n        );\r\n        productoEnStock.stock += 1;\r\n\r\n        // Actualizar la lista de productos en el estado\r\n        setProductos([...productos]);\r\n\r\n        // Actualizar el stock en la base de datos\r\n        axios\r\n          .post(\r\n            `http://localhost:3001/api/productos/${producto.id}/actualizarStock`,\r\n            {\r\n              nuevoStock: productoEnStock.stock,\r\n            }\r\n          )\r\n          .then((response) => {\r\n            console.log(\"Stock actualizado en la base de datos\");\r\n          })\r\n          .catch((error) => {\r\n            console.error(\r\n              \"Error al actualizar el stock en la base de datos:\",\r\n              error\r\n            );\r\n          });\r\n\r\n        // Reducir el total de venta en el precio del producto\r\n        setTotalVenta(totalVenta - producto.precio);\r\n      }\r\n    }\r\n  };\r\n\r\n  // Función para eliminar un producto del carrito\r\n  const eliminarDelCarrito = (producto) => {\r\n    const nuevoCarrito = carrito.filter((item) => item.id !== producto.id);\r\n    setCarrito(nuevoCarrito);\r\n    setTotalVenta(totalVenta - producto.precio * producto.cantidad);\r\n\r\n    // Devolver el stock al producto en la base de datos\r\n    const productoEnStock = productos.find((item) => item.id === producto.id);\r\n    productoEnStock.stock += producto.cantidad;\r\n\r\n    // Actualizar la lista de productos en el estado (esto es importante para mostrar el stock actualizado)\r\n    setProductos([...productos]);\r\n\r\n    // Actualizar el stock en la base de datos\r\n    axios\r\n      .post(\r\n        `http://localhost:3001/api/productos/${producto.id}/actualizarStock`,\r\n        {\r\n          nuevoStock: productoEnStock.stock,\r\n        }\r\n      )\r\n      .then((response) => {\r\n        console.log(\"Stock actualizado en la base de datos\");\r\n      })\r\n      .catch((error) => {\r\n        console.error(\r\n          \"Error al actualizar el stock en la base de datos:\",\r\n          error\r\n        );\r\n      });\r\n  };\r\n\r\n  const cambiarCantidad = (producto, nuevaCantidad) => {\r\n    const nuevoCarrito = carrito.map((item) => {\r\n      if (item.id === producto.id) {\r\n        return { ...item, cantidad: nuevaCantidad };\r\n      }\r\n      return item;\r\n    });\r\n    setCarrito(nuevoCarrito);\r\n    calcularTotalVenta(nuevoCarrito);\r\n  };\r\n\r\n  // Función para calcular el total de la venta\r\n  const calcularTotalVenta = (nuevoCarrito) => {\r\n    let nuevoTotal = 0;\r\n    nuevoCarrito.forEach((item) => {\r\n      nuevoTotal += item.precio * item.cantidad;\r\n    });\r\n    setTotalVenta(nuevoTotal);\r\n  };\r\n\r\n  const realizarPago = () => {\r\n    // Verificar si hay productos en el carrito y el total de compra es mayor que cero\r\n    if (carrito.length === 0 || totalVenta === 0) {\r\n      Swal.fire({\r\n        title: \"No hay productos en el carrito\",\r\n        icon: \"error\",\r\n        confirmButtonText: \"Ok\",\r\n      });\r\n    } else {\r\n      // Generar el contenido del código QR y mostrarlo;\r\n      \r\n      \r\n      setShowQRDialog(true);\r\n    }\r\n  };\r\n\r\n  const manejarPago = async () => {\r\n    try {\r\n      // Verificar si MetaMask está instalado\r\n      if (typeof window.ethereum !== 'undefined') {\r\n        const web3 = new Web3(window.ethereum);\r\n\r\n        // Comprobar si el usuario está conectado\r\n        const accounts = await web3.eth.getAccounts();\r\n        if (accounts.length === 0) {\r\n          throw new Error(\"No se ha detectado una billetera Ethereum.\");\r\n        }\r\n\r\n        // Crear una transacción para enviar el pago a la dirección de la billetera\r\n        const transaction = {\r\n          to: direccionWallet, // Dirección de destino\r\n          value: web3.utils.toWei(totalVenta.toString(), \"ether\"), // Monto en Wei\r\n        };\r\n\r\n        // Enviar la transacción a través de MetaMask\r\n        await web3.eth.sendTransaction(transaction);\r\n\r\n        // Transacción exitosa, mostrar un mensaje\r\n        Swal.fire({\r\n          title: \"Pago exitoso\",\r\n          icon: \"success\",\r\n          text: `Se ha realizado un pago de ${totalVenta} Ether a la dirección ${direccionWallet}.`,\r\n          confirmButtonText: \"Ok\",\r\n        });\r\n\r\n        // Cerrar el cuadro de diálogo QR y reiniciar el estado\r\n        setShowQRDialog(false);\r\n        setCarrito([]);\r\n        setTotalVenta(0);\r\n      } else {\r\n        throw new Error(\"MetaMask no está instalado o no está disponible.\");\r\n      }\r\n    } catch (error) {\r\n      // Manejar errores, por ejemplo, si el usuario rechaza la transacción en MetaMask\r\n      Swal.fire({\r\n        title: \"Error en el pago\",\r\n        icon: \"error\",\r\n        text: \"Se produjo un error al procesar el pago.\",\r\n        confirmButtonText: \"Ok\",\r\n      });\r\n    }\r\n  };\r\n  const handleVolverAtras = () => {\r\n    window.history.back();\r\n  };\r\n  \r\n  \r\n  return (\r\n    <div className=\"container\">\r\n      <h1>Productos en Venta</h1>\r\n      <button onClick={handleVolverAtras}>Volver Atrás</button>\r\n      <br></br>\r\n      <br></br>\r\n      <div className=\"row\">\r\n        <div\r\n          className=\"col-md-9\"\r\n          style={{ maxHeight: \"600px\", overflowY: \"scroll\" }}\r\n        >\r\n          <div className=\"row\">\r\n            {productos.map((producto) => (\r\n              <div className=\"col-md-4 mb-4\" key={producto.id}>\r\n                <div className=\"card\">\r\n                  <div className=\"card-body\">\r\n                    <h5 className=\"card-title\">{producto.nombre}</h5>\r\n                    <p className=\"card-text\">{producto.descripcion}</p>\r\n                    <p className=\"card-text\">Precio: {producto.precio}</p>\r\n                    {producto.stock > 0 ? (\r\n                      <button\r\n                        className=\"btn btn-primary\"\r\n                        onClick={() => agregarAlCarrito(producto)}\r\n                      >\r\n                        Agregar\r\n                      </button>\r\n                    ) : (\r\n                      <p className=\"text-danger\">Producto Agotado</p>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </div>\r\n        <div className=\"col-md-3\">\r\n          <div\r\n            className=\"mt-2\"\r\n            style={{ maxHeight: \"500px\", overflowY: \"scroll\" }}\r\n          >\r\n            <h2>Ticket</h2>\r\n            <table className=\"table table-sm\">\r\n              <thead>\r\n                <tr>\r\n                  <th>Producto</th>\r\n                  <th>Cantidad</th>\r\n                  <th>Precio</th>\r\n                  <th>Acción</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {carrito.map((item, index) => (\r\n                  <tr key={index}>\r\n                    <td>{item.nombre}</td>\r\n                    <td>\r\n                      <input\r\n                        type=\"number\"\r\n                        min=\"1\"\r\n                        className=\"form-control\"\r\n                        value={item.cantidad}\r\n                        onChange={(e) =>\r\n                          cambiarCantidad(item, parseInt(e.target.value))\r\n                        }\r\n                      />\r\n                    </td>\r\n                    <td>{(item.precio * item.cantidad).toFixed(2)}</td>\r\n                    <td>\r\n                      <button\r\n                        className=\"btn btn-primary\"\r\n                        onClick={() => agregarAlCarrito(item)}\r\n                      >\r\n                        +\r\n                      </button>\r\n                      <button\r\n                        className=\"btn btn-warning\"\r\n                        onClick={() => desagregarDelCarrito(item)}\r\n                      >\r\n                        -\r\n                      </button>\r\n                      <button\r\n                        className=\"btn btn-danger\"\r\n                        onClick={() => eliminarDelCarrito(item)}\r\n                      >\r\n                        Quitar\r\n                      </button>\r\n                    </td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n          <p className=\"total-venta\">\r\n            Total de Venta: <strong>{totalVenta.toFixed(2)}</strong>\r\n          </p>\r\n          {carrito.length > 0 && (\r\n            <button className=\"btn btn-success\" onClick={realizarPago} data-bs-toggle=\"modal\" data-bs-target=\"#exampleModal\" >\r\n              Pago\r\n            </button>\r\n          )}\r\n          {showQRDialog && (\r\n            <div class=\"modal fade\" id=\"exampleModal\" tabindex=\"-1\" aria-labelledby=\"exampleModalLabel\" aria-hidden=\"true\">\r\n            <div class=\"modal-dialog\">\r\n              <div class=\"modal-content\">\r\n                <div class=\"modal-header\">\r\n                  <h1 class=\"modal-title fs-5\" id=\"exampleModalLabel\">Modal title</h1>\r\n                  <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>\r\n                </div>\r\n                <div class=\"modal-body\">\r\n                <div className=\"qr-dialog\">\r\n          \r\n          <h2>Escanee el código QR para realizar el pago</h2>\r\n          <EthereumQRCode address={direccionWallet} amount={value} />\r\n          <p>Total de Venta: <strong>{totalVenta.toFixed(2)}</strong></p>\r\n          <button\r\n            className=\"btn btn-primary\"\r\n            onClick={manejarPago}\r\n          >\r\n            Realizar Pago\r\n          </button>\r\n          <button\r\n            className=\"btn btn-secondary\"\r\n            onClick={() => setShowQRDialog(false)}\r\n          >\r\n            Cancelar\r\n          </button>\r\n        </div>\r\n                </div>\r\n                <div class=\"modal-footer\">\r\n                  <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Close</button>\r\n                  <button type=\"button\" class=\"btn btn-primary\">Save changes</button>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n       \r\n      )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Ventas;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}